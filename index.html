<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Codon Usage Tool with Explainable AI</title>
  <link rel="stylesheet" href="/static/style.css">
  <!-- Add Chart.js for visualizations -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
</head>

<body>

  <!-- Network Background -->
  <canvas id="network-bg"></canvas>

  <!-- Image Overlay -->
  <div class="overlay" id="overlay"></div>
  
  <!-- Image Title -->
  <div class="image-title" id="imageTitle"></div>

  <!-- Header -->
  <div class="header">
    <div class="logo">üß¨</div>
    <div class="nav-icons">
      <div class="nav-icon active" onclick="showPage('home')" title="Home">üè†</div>
      <div class="nav-icon" onclick="showPage('shap')" title="SHAP Explanations">üîç</div>
      <div class="nav-icon" onclick="showPage('metrics')" title="Metrics">üìä</div>
      <div class="nav-icon" onclick="showPage('proof')" title="Training Proof">üìà</div>
    </div>
  </div>

  <!-- Main Container -->
  <div class="container">

    <!-- Page 1: Home - Hybrid Codon Recommendation System -->
    <div id="home" class="page active">
      <div class="page-title">Codon Usage Tool</div>
      <div class="page-subtitle">[Optimize & Analyze]</div>

      <div class="form-group">
        <label>Amino Acid (Single Letter):</label>
        <input id="aa" placeholder="Example: L, K, F">
      </div>

      <div class="form-group">
        <label>Codon (RNA format, optional):</label>
        <input id="codon" placeholder="Example: UUA, UUU">
      </div>

      <div class="form-group">
        <label>Target Host Species (optional):</label>
        <input id="host" placeholder="Example: Escherichia coli">
      </div>

      <button onclick="analyze()">Analyze</button>

      <div id="loading" style="display: none; text-align: center; margin-top: 20px; color: #d4af37;">
        <p>üîÑ Analyzing... Please wait</p>
      </div>

      <div id="error-message" style="display: none; text-align: center; margin-top: 20px; padding: 15px; background: rgba(255, 0, 0, 0.1); border: 1px solid #ff0000; border-radius: 10px; color: #ff6b6b;">
      </div>

      <div id="home-results" style="display: none;">

        <div class="result-section">
          <h3>Codon Ranking</h3>
          <table id="rankingTable">
            <thead>
              <tr>
                <th>Rank</th>
                <th>Codon</th>
                <th>Frequency</th>
                <th>ML Weight</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>

        <div class="result-section">
          <h3 class="species-highlight">Top Species (Usage Based)</h3>
          <ul id="species"></ul>
        </div>

        <!-- Species Specific Preference -->
        <div class="result-section">
          <h3>Species-Specific Codon Preference</h3>
          <div class="flex-container">
            <div class="half-section">
              <h4 class="subsection-title">High Preference Species</h4>
              <ul id="speciesHigh" class="species-list"></ul>
            </div>
            <div class="half-section">
              <h4 class="subsection-title">Low Preference Species</h4>
              <ul id="speciesLow" class="species-list"></ul>
            </div>
          </div>
          <div class="info-box" id="speciesExplain"></div>
        </div>

        <!-- Host-Aware Optimization -->
        <div class="result-section">
          <h3>Host-Aware Codon Optimization</h3>
          <div class="info-box" id="hostResult"></div>
          <div id="hostRankingContainer" style="display: none; margin-top: 15px;">
            <h4 class="subsection-title">Host-Specific Codon Ranking</h4>
            <table id="hostRankingTable">
              <thead>
                <tr>
                  <th>Rank</th>
                  <th>Codon</th>
                  <th>Usage in Host</th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>
        </div>

      </div>
    </div>

    <!-- Page 2: SHAP Explanations -->
    <div id="shap" class="page">
      <div class="page-title">üîç Explainable AI - SHAP Analysis</div>
      <div class="page-subtitle">Understanding Model Predictions</div>

      <!-- SHAP Explanation Section -->
      <div id="shap-results" style="display: none;">
        
        <!-- Quick Summary -->
        <div class="result-section">
          <h3>üìã Explanation Summary</h3>
          <div id="shap-summary" class="info-box"></div>
        </div>

        <!-- Feature Importance Chart -->
        <div class="result-section">
          <h3>üìä Feature Contributions</h3>
          <div style="max-width: 100%; overflow-x: auto;">
            <canvas id="shapBarChart" style="max-height: 400px;"></canvas>
          </div>
          <div class="info-box" style="margin-top: 15px;">
            <strong>Interpretation:</strong> This chart shows which codons/features have the strongest influence on the model's prediction. 
            Positive values (green) push the prediction higher, while negative values (red) push it lower.
          </div>
        </div>

        <!-- Top Features Table -->
        <div class="result-section">
          <h3>üéØ Top Contributing Features</h3>
          <table id="shapFeaturesTable">
            <thead>
              <tr>
                <th>Rank</th>
                <th>Feature</th>
                <th>SHAP Value</th>
                <th>Effect</th>
                <th>% Contribution</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>

        <!-- Waterfall Visualization -->
        <div class="result-section">
          <h3>üíß Waterfall Plot - Cumulative Effects</h3>
          <div style="max-width: 100%; overflow-x: auto;">
            <canvas id="waterfallChart" style="max-height: 400px;"></canvas>
          </div>
          <div class="info-box" style="margin-top: 15px;">
            <strong>How to read:</strong> Starting from the base value (average prediction), each bar shows how a feature 
            pushes the prediction up or down, leading to the final prediction value.
          </div>
        </div>

        <!-- Feature Interactions -->
        <div class="result-section" id="interactionsSection" style="display: none;">
          <h3>üîó Feature Interactions</h3>
          <table id="interactionsTable">
            <thead>
              <tr>
                <th>Interacting Feature</th>
                <th>Interaction Strength</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
          <div class="info-box" style="margin-top: 15px;">
            <strong>Interaction Effects:</strong> These features work together with the selected codon. 
            High interaction values indicate synergistic or antagonistic relationships between features.
          </div>
        </div>

        <!-- Interpretation -->
        <div class="result-section">
          <h3>üí° AI Interpretation</h3>
          <div id="shap-interpretation" class="info-box" style="background: rgba(212, 175, 55, 0.1); border-left: 4px solid #d4af37;">
          </div>
        </div>

      </div>

      <!-- No SHAP Data Message -->
      <div id="no-shap-data" class="result-section">
        <div class="info-box" style="text-align: center; padding: 30px;">
          <h3 style="color: #d4af37; margin-bottom: 15px;">‚ÑπÔ∏è No SHAP Explanation Available</h3>
          <p style="margin-bottom: 10px;">To see SHAP explanations, please:</p>
          <ol style="text-align: left; display: inline-block; margin: 0 auto;">
            <li>Go to the <strong>Home</strong> tab</li>
            <li>Enter an amino acid (e.g., "L")</li>
            <li>Enter a codon (e.g., "UUA")</li>
            <li>Click <strong>Analyze</strong></li>
            <li>Return to this tab to view SHAP explanations</li>
          </ol>
          <p style="margin-top: 15px; color: #888;">
            SHAP values explain which features contribute most to the model's predictions.
          </p>
        </div>
      </div>

      <!-- Global Feature Importance -->
      <div class="result-section">
        <h3>üåç Global Feature Importance</h3>
        <button onclick="loadGlobalImportance()" style="width: auto; padding: 10px 20px; margin-bottom: 15px;">
          Load Global Importance
        </button>
        <div id="global-importance-container" style="display: none;">
          <div style="max-width: 100%; overflow-x: auto;">
            <canvas id="globalImportanceChart" style="max-height: 500px;"></canvas>
          </div>
          <div class="info-box" style="margin-top: 15px;">
            <strong>Global Importance:</strong> These are the most influential features across all species in the dataset.
          </div>
        </div>
      </div>

    </div>

    <!-- Page 3: Metrics -->
    <div id="metrics" class="page">
      <div class="page-title">Model Performance Metrics</div>
      <div class="page-subtitle">Accuracy Comparison & Evaluation</div>

      <div class="result-section">
        <h3>Accuracy Comparison</h3>
        <table id="accuracyCompare">
          <thead>
            <tr>
              <th>Model</th>
              <th>Accuracy</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>Codon Only</td>
              <td id="accCodon">‚Äî</td>
            </tr>
            <tr>
              <td>Codon + BWT</td>
              <td id="accBWT">‚Äî</td>
            </tr>
          </tbody>
        </table>
      </div>

      <div class="result-section">
        <h3>Model Evaluation Metrics</h3>
        <table id="metricsTable">
          <thead>
            <tr>
              <th>Metric</th>
              <th>Value</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>Top-1 Accuracy</td>
              <td>‚Äî</td>
            </tr>
            <tr>
              <td>Top-2 Accuracy</td>
              <td>‚Äî</td>
            </tr>
            <tr>
              <td>Top-3 Accuracy</td>
              <td>‚Äî</td>
            </tr>
            <tr>
              <td>Precision</td>
              <td>‚Äî</td>
            </tr>
            <tr>
              <td>Recall</td>
              <td>‚Äî</td>
            </tr>
            <tr>
              <td>F1 Score</td>
              <td>‚Äî</td>
            </tr>
            <tr>
              <td>Loss</td>
              <td>‚Äî</td>
            </tr>
            <tr>
              <td>Error</td>
              <td>‚Äî</td>
            </tr>
          </tbody>
        </table>

        <div class="metric-note">
          <strong>Note:</strong>
          Top-1 accuracy reflects primary classification performance, while
          Top-2 and Top-3 accuracies measure prediction robustness.
          Error rate is computed as one minus Top-1 accuracy.
        </div>
      </div>

      <div class="result-section">
        <h3>Robustness Evaluation</h3>
        <table id="robustnessTable">
          <thead>
            <tr>
              <th>Data Condition</th>
              <th>Accuracy</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>Clean</td>
              <td id="accClean">‚Äî</td>
            </tr>
            <tr>
              <td>Noisy</td>
              <td id="accNoisy">‚Äî</td>
            </tr>
            <tr>
              <td>Missing</td>
              <td id="accMissing">‚Äî</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <!-- Page 4: Training Proof -->
    <div id="proof" class="page">
      <div class="page-title">Training & Evaluation Proof</div>
      <div class="page-subtitle">Model Training Visualizations</div>

      <div class="result-section">
        <div class="img-grid">
          <img src="/static/Codon_BWT.png" alt="Codon BWT" onclick="expandImage(this)">
          <img src="/static/BWT impact output.png" alt="BWT Impact" onclick="expandImage(this)">
          <img src="/static/Confusion Matrix output.png" alt="Confusion Matrix" onclick="expandImage(this)">
          <img src="/static/Feature Correlation Heatmap output.png" alt="Feature Correlation" onclick="expandImage(this)">
          <img src="/static/Residual Dist output.png" alt="Residual Distribution" onclick="expandImage(this)">
          <img src="/static/Residuals vs Predictions output.png" alt="Residuals vs Predictions" onclick="expandImage(this)">
          <img src="/static/Test data metric output.png" alt="Test Data Metrics" onclick="expandImage(this)">
          <img src="/static/Training vs test Acc output.png" alt="Training vs Test Accuracy" onclick="expandImage(this)">
          <img src="/static/Training vs test loss output.png" alt="Training vs Test Loss" onclick="expandImage(this)">
          <img src="/static/Recall_F1 Score.png" alt="Recall F1 Score" onclick="expandImage(this)">
        </div>
      </div>
    </div>

  </div>

  <script src="/static/script.js"></script>

</body>

</html>