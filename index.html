<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Codon Usage Tool</title>
  <link rel="stylesheet" href="/static/style.css">
  
</head>

<body>

  <canvas id="network-bg"></canvas>
  <div class="overlay" id="overlay"></div>
  <div class="image-title" id="imageTitle"></div>

  <div class="header">
    <div class="logo">Codon Usage Tool</div>
    <div class="nav-icons">
      <div class="nav-icon active" onclick="showPage('home')" title="Home">üè†</div>
      <div class="nav-icon" onclick="showPage('metrics')" title="Metrics">üìä</div>
      <div class="nav-icon" onclick="showPage('proof')" title="Training Proof">üìà</div>
    </div>
  </div>

  <div class="container">

    <!-- HOME PAGE -->
    <div id="home" class="page active">
      <div class="page-title">Codon Usage Tool</div>
      <div class="page-subtitle">[Default Optimize Page]</div>

      <div class="form-group">
        <label>Amino Acid (Single Letter):</label>
        <input id="aa" placeholder="Example: L, K, F" type="text">
      </div>

      <div class="form-group">
        <label>Codon (RNA format, optional - for bias analysis):</label>
        <input id="codon" list="codonSuggestions" placeholder="e.g., UUA, GCC, UAA" type="text">
        <datalist id="codonSuggestions">
          <option value="UUA">
          <option value="UUG">
          <option value="CUU">
          <option value="CUC">
          <option value="CUA">
          <option value="CUG">
          <option value="GCC">
          <option value="GCU">
          <option value="GCA">
          <option value="GCG">
          <option value="UAA">
          <option value="UAG">
          <option value="UGA">
        </datalist>
      </div>

      <div class="form-group">
        <label>Target Host Species (optional):</label>
        <input id="host" list="hostSuggestions" placeholder="e.g., E. coli, coli, Human, Yeast, Bacillus" type="text">
        <datalist id="hostSuggestions">
          <option value="Escherichia coli">
          <option value="E. coli">
          <option value="coli">
          <option value="Bacillus subtilis">
          <option value="Saccharomyces cerevisiae">
          <option value="Yeast">
          <option value="Homo sapiens">
          <option value="Human">
          <option value="Mus musculus">
          <option value="Mouse">
          <option value="Arabidopsis thaliana">
          <option value="Drosophila melanogaster">
          <option value="Pseudomonas aeruginosa">
          <option value="Staphylococcus aureus">
          <option value="Mycobacterium tuberculosis">
        </datalist>
      </div>

      <button onclick="analyze()">Analyze</button>

      <div id="loading" style="display:none;">
        <p>üî¨ Analyzing codon usage...</p>
      </div>

      <div id="error-message" style="display:none;"></div>

      <div id="home-results" style="display:none;">

        <!-- CODON RANKING -->
        <div class="result-section">
          <h3>Codon Ranking</h3>
          <table id="rankingTable">
            <thead>
              <tr>
                <th>Rank</th>
                <th>Codon</th>
                <th>Frequency</th>
                <th>ML Weight</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>

        <!-- TOP SPECIES -->
        <div class="result-section">
          <h3 class="species-highlight">Top Species (Usage Based)</h3>
          <ul id="species"></ul>
        </div>

        <!-- SPECIES PREFERENCE -->
        <div class="result-section">
          <h3>Species-Specific Codon Preference</h3>
          <div class="flex-container">
            <div class="half-section">
              <h4 class="subsection-title">High Preference Species</h4>
              <ul id="speciesHigh" class="species-list"></ul>
            </div>
            <div class="half-section">
              <h4 class="subsection-title">Low Preference Species</h4>
              <ul id="speciesLow" class="species-list"></ul>
            </div>
          </div>
          <div class="info-box" id="speciesExplain"></div>
        </div>

        <!-- HOST OPTIMIZATION -->
        <div class="result-section">
          <h3>Host-Aware Codon Optimization</h3>
          <div class="info-box" id="hostResult"></div>
          <div id="hostRankingContainer" style="display:none;margin-top:15px;">
            <h4 class="subsection-title">Host-Specific Codon Ranking</h4>
            <table id="hostRankingTable">
              <thead>
                <tr>
                  <th>Rank</th>
                  <th>Codon</th>
                  <th>Usage in Host</th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>
        </div>

        <!-- CODON BIAS -->
        <div class="result-section">
          <h3>Codon Bias Score</h3>
          <div class="info-box" id="biasResult"></div>
          <div id="biasTableContainer" style="display:none;margin-top:15px;">
            <table id="biasTable">
              <thead>
                <tr>
                  <th>Species</th>
                  <th>Bias Score</th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>
        </div>

        <!-- KINGDOM COMPARISON -->
        <div class="result-section">
          <h3>Cross-Kingdom Codon Comparison</h3>
          <table id="kingdomTable">
            <thead>
              <tr>
                <th>Kingdom</th>
                <th>Average Usage</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
          <div class="info-box" style="margin-top:15px;">
            <strong>Note:</strong> This comparison shows how codon usage varies across different kingdoms of life, revealing evolutionary preferences.
          </div>
        </div>

        <!-- SHAP SECTION -->
        <div class="result-section">
          <h3>AI Model Explanation (SHAP)</h3>
          <div class="info-box">
            <strong>What are SHAP values?</strong><br>
            SHAP (SHapley Additive exPlanations) values show how much each codon influences the AI model's prediction.<br><br>
            
            <strong style="color:#4CAF50;">‚úì Positive values (Green):</strong> This codon increases the model's confidence that it should be used for this amino acid. Higher positive values mean the model strongly recommends this codon.<br><br>
            
            <strong style="color:#FF5252;">‚úó Negative values (Red):</strong> This codon decreases the model's confidence. The model suggests avoiding this codon for optimal expression.<br><br>
            
            <strong>Value magnitude:</strong> The size of the value (ignoring +/-) indicates strength of influence. Larger absolute values = stronger influence on the prediction.
          </div>

          <!-- Feature 1: Top 10 Contributing Features (Codon + BWT) -->
          <h4 style="color:#d4af37;margin-top:25px;margin-bottom:15px;">üìä Top 10 Contributing Features</h4>
          <div class="info-box" style="margin-bottom:15px;font-size:13px;">
            Shows the most important features (both codons and BWT transformations) that influence the model's prediction.
          </div>
          <div id="shapChart"></div>
          <table id="shapTable" style="margin-top:15px;">
            <thead>
              <tr>
                <th>Feature</th>
                <th>Type</th>
                <th>SHAP Impact</th>
                <th>Interpretation</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>

          <!-- Feature 2: BWT Feature Importance -->
          <h4 style="color:#d4af37;margin-top:30px;margin-bottom:15px;">üß¨ BWT Feature Importance</h4>
          <div class="info-box" style="margin-bottom:15px;font-size:13px;">
            Burrows-Wheeler Transform (BWT) features capture sequence patterns and context. 
            This shows how BWT transformations contribute to codon prediction accuracy.
          </div>
          <div id="bwtChart" style="margin-top:15px;"></div>
          <table id="bwtTable" style="margin-top:15px;">
            <thead>
              <tr>
                <th>BWT Feature</th>
                <th>Importance Score</th>
                <th>Impact</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>

          <!-- Feature 3: Codon-Only vs Codon+BWT Comparison -->
          <h4 style="color:#d4af37;margin-top:30px;margin-bottom:15px;">‚öñÔ∏è Model Comparison: Codon-Only vs Codon+BWT</h4>
          <div class="info-box" style="margin-bottom:15px;font-size:13px;">
            Compares SHAP values between the basic Codon-only model and the enhanced Codon+BWT model.
            Shows how BWT features refine codon predictions.
          </div>
          <div id="comparisonChart" style="margin-top:15px;"></div>
          <table id="comparisonTable" style="margin-top:15px;">
            <thead>
              <tr>
                <th>Codon</th>
                <th>Codon-Only SHAP</th>
                <th>Codon+BWT SHAP</th>
                <th>BWT Contribution</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>

      </div>
    </div>

    <!-- METRICS PAGE -->
    <div id="metrics" class="page">
      <div class="page-title">Model Performance Metrics</div>
      <div class="page-subtitle">Accuracy Comparison & Evaluation</div>

      <div class="result-section">
        <h3>Accuracy Comparison</h3>
        <table id="accuracyCompare">
          <thead>
            <tr>
              <th>Model</th>
              <th>Accuracy</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>Codon Only</td>
              <td id="accCodon">‚Äì</td>
            </tr>
            <tr>
              <td>Codon + BWT</td>
              <td id="accBWT">‚Äì</td>
            </tr>
          </tbody>
        </table>
      </div>

      <div class="result-section">
        <h3>Model Evaluation Metrics</h3>
        <table id="metricsTable">
          <thead>
            <tr>
              <th>Metric</th>
              <th>Value</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>Top-1 Accuracy</td>
              <td>‚Äì</td>
            </tr>
            <tr>
              <td>Top-2 Accuracy</td>
              <td>‚Äì</td>
            </tr>
            <tr>
              <td>Top-3 Accuracy</td>
              <td>‚Äì</td>
            </tr>
            <tr>
              <td>Precision</td>
              <td>‚Äì</td>
            </tr>
            <tr>
              <td>Recall</td>
              <td>‚Äì</td>
            </tr>
            <tr>
              <td>F1 Score</td>
              <td>‚Äì</td>
            </tr>
            <tr>
              <td>Loss</td>
              <td>‚Äì</td>
            </tr>
            <tr>
              <td>Error</td>
              <td>‚Äì</td>
            </tr>
          </tbody>
        </table>

        <div class="metric-note">
          <strong>Note:</strong>
          Top-1 accuracy reflects primary classification performance, while
          Top-2 and Top-3 accuracies measure prediction robustness.
          Error rate is computed as one minus Top-1 accuracy.
        </div>
      </div>

      <div class="result-section">
        <h3>Robustness Evaluation</h3>
        <table id="robustnessTable">
          <thead>
            <tr>
              <th>Data Condition</th>
              <th>Accuracy</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>Clean</td>
              <td id="accClean">‚Äì</td>
            </tr>
            <tr>
              <td>Noisy</td>
              <td id="accNoisy">‚Äì</td>
            </tr>
            <tr>
              <td>Missing</td>
              <td id="accMissing">‚Äì</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <!-- PROOF PAGE -->
    <div id="proof" class="page">
      <div class="page-title">Training & Evaluation Proof</div>
      <div class="page-subtitle">Model Training Visualizations</div>

      <div class="result-section">
        <div class="img-grid">
          <img src="/static/Codon_BWT.png" alt="Codon BWT" onclick="expandImage(this)">
          <img src="/static/BWT impact output.png" alt="BWT Impact" onclick="expandImage(this)">
          <img src="/static/Confusion Matrix output.png" alt="Confusion Matrix" onclick="expandImage(this)">
          <img src="/static/Feature Correlation Heatmap output.png" alt="Feature Correlation" onclick="expandImage(this)">
          <img src="/static/Residual Dist output.png" alt="Residual Distribution" onclick="expandImage(this)">
          <img src="/static/Residuals vs Predictions output.png" alt="Residuals vs Predictions" onclick="expandImage(this)">
          <img src="/static/Test data metric output.png" alt="Test Data Metrics" onclick="expandImage(this)">
          <img src="/static/Training vs test Acc output.png" alt="Training vs Test Accuracy" onclick="expandImage(this)">
          <img src="/static/Training vs test loss output.png" alt="Training vs Test Loss" onclick="expandImage(this)">
          <img src="/static/Recall_F1 Score.png" alt="Recall F1 Score" onclick="expandImage(this)">
        </div>
      </div>
    </div>

  </div>

  <script src="/static/script.js"></script>
  
</body>
</html>